<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>实用德州扑克AI助手 - Vercel版</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .poker-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 768px) {
            .poker-table { grid-template-columns: 1fr; }
        }
        
        .input-section, .result-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
        }
        
        .section-title {
            font-size: 1.3em;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .card-input {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .card-input input {
            text-align: center;
            text-transform: uppercase;
            font-weight: bold;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
            margin: 10px 0;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        .btn.success {
            background: #27ae60;
        }
        
        .btn.success:hover {
            background: #229954;
        }
        
        .actions-display {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .action-card {
            padding: 15px;
            background: #ecf0f1;
            border-radius: 8px;
            text-align: center;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .action-card.recommended {
            background: #d5f4e6;
            border-color: #27ae60;
            transform: scale(1.05);
        }
        
        .action-card.likely {
            background: #e8f4fd;
            border-color: #3498db;
        }
        
        .action-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .action-prob {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .hand-analysis {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .analysis-row {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
        
        .recommendation {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            margin-top: 20px;
        }
        
        .error {
            background: #fadbd8;
            color: #c0392b;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .success {
            background: #d5f4e6;
            color: #27ae60;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .card-display {
            display: inline-block;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 5px 8px;
            margin: 2px;
            font-family: monospace;
            font-weight: bold;
        }
        
        .spades, .clubs { color: #000; }
        .hearts, .diamonds { color: #e74c3c; }
        
        .info-box {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid;
        }
        
        .info-box.card-format {
            background: #fff3cd;
            border-color: #ffc107;
        }
        
        .info-box.pot-betting {
            background: #e7f3ff;
            border-color: #0066cc;
        }
        
        .info-box.position-guide {
            background: #f0f8ff;
            border-color: #4169e1;
        }
        
        .info-box.hand-examples {
            background: #f8f9fa;
            border-color: #28a745;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎰 实用德州扑克AI助手</h1>
            <p>支持多人桌、具体手牌输入、专业位置分析 (Vercel版)</p>
        </div>
        
        <div class="poker-table">
            <div class="input-section">
                <h3 class="section-title">🎮 游戏设置</h3>
                
                <div class="form-group">
                    <label>桌子人数</label>
                    <select id="numPlayers">
                        <option value="6" selected>6人桌 (6-max)</option>
                        <option value="5">5人桌 (5-max)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>你的位置</label>
                    <select id="position">
                        <option value="UTG">UTG (枪口位)</option>
                        <option value="MP">MP (中位)</option>
                        <option value="CO">CO (关煞位)</option>
                        <option value="BTN" selected>BTN (按钮位)</option>
                        <option value="SB">SB (小盲位)</option>
                        <option value="BB">BB (大盲位)</option>
                    </select>
                    <div class="info-box position-guide">
                        <strong>🎯 位置详解:</strong><br>
                        <strong>早期位置 (紧凶策略):</strong><br>
                        • <strong>UTG (Under The Gun/枪口位):</strong> 第一个行动，信息最少，需要最强的起手牌。只玩AA,KK,QQ,JJ,AKs,AKo等顶级牌<br>
                        • <strong>MP (Middle Position/中位):</strong> 仅6人桌有，可以稍微放宽要求，增加AQ,KQ等牌<br><br>
                        <strong>后期位置 (积极策略):</strong><br>
                        • <strong>CO (Cut Off/关煞位):</strong> 倒数第二个行动，位置优势明显，可以玩更多牌型，包括投机牌<br>
                        • <strong>BTN (Button/按钮位):</strong> 最后行动，位置最佳，可以玩最宽的范围，甚至用弱牌偷盲<br><br>
                        <strong>盲注位置 (被动位置):</strong><br>
                        • <strong>SB (Small Blind/小盲位):</strong> 翻牌后第一个行动，位置劣势，起手牌要求较高<br>
                        • <strong>BB (Big Blind/大盲位):</strong> 已投入盲注，有底池赔率保护，可以看更多翻牌<br><br>
                        <strong>位置策略要点:</strong> 后位可以看到前面玩家的行动再做决定，因此可以玩更多牌型；前位信息不足，必须用强牌进入底池
                    </div>
                </div>
                
                <div class="form-group">
                    <label>你的底牌</label>
                    <div class="card-input">
                        <input type="text" id="card1" placeholder="As" maxlength="2">
                        <input type="text" id="card2" placeholder="Kh" maxlength="2">
                    </div>
                    <div class="info-box card-format">
                        <strong>🎴 牌面输入格式说明:</strong><br>
                        <strong>花色字母:</strong> s=♠黑桃, h=♥红桃, d=♦方块, c=♣梅花<br>
                        <strong>点数字母:</strong> A,K,Q,J,T,9,8,7,6,5,4,3,2 (注意:10用T表示)<br>
                        <strong>示例:</strong> As=黑桃A, Kh=红桃K, Qd=方块Q, Jc=梅花J, Ts=黑桃10<br>
                        <strong>常见起手牌:</strong> AA, KK, QQ, JJ, AKs, AKo, AQ, KQ, TT, 99
                    </div>
                </div>
                
                <div class="form-group">
                    <label>公共牌 (可选)</label>
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px;">
                        <input type="text" id="flop1" placeholder="翻牌1" maxlength="2">
                        <input type="text" id="flop2" placeholder="翻牌2" maxlength="2">
                        <input type="text" id="flop3" placeholder="翻牌3" maxlength="2">
                        <input type="text" id="turn" placeholder="转牌" maxlength="2">
                        <input type="text" id="river" placeholder="河牌" maxlength="2">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>底池大小</label>
                        <input type="number" id="potSize" value="100">
                        <small style="color: #6c757d;">当前底池中的总筹码数量</small>
                    </div>
                    <div class="form-group">
                        <label>需要跟注</label>
                        <input type="number" id="betToCall" value="20">
                        <small style="color: #6c757d;">轮到你时需要跟注的筹码数(0=可以过牌)</small>
                    </div>
                </div>
                
                <div class="info-box pot-betting">
                    <strong>💰 底池和下注说明:</strong><br>
                    <strong>底池大小:</strong> 桌面上已有的总筹码(包括盲注、前面玩家的下注等)<br>
                    <strong>需要跟注:</strong> 你需要投入多少筹码才能继续游戏<br>
                    <strong>常见情况:</strong><br>
                    • 需要跟注=0 → 可以过牌(CHECK)<br>
                    • 需要跟注>0 → 必须跟注(CALL)或加注(RAISE)或弃牌(FOLD)<br>
                    <strong>示例:</strong> 底池100，需跟注20 → 底池赔率=20/(100+20)=16.7%
                </div>
                
                <div class="form-group">
                    <label>你的筹码量</label>
                    <input type="number" id="stackSize" value="1000">
                </div>
                
                <button class="btn success" onclick="getAIRecommendation()">获取AI建议</button>
                <button class="btn" onclick="randomizeHand()">随机手牌</button>
                <button class="btn" onclick="loadExample()">加载示例</button>
                
                <div class="info-box hand-examples">
                    <strong>📋 快速示例:</strong><br>
                    <strong>强起手牌:</strong> AA, KK, QQ, JJ, AKs, AKo, AQs<br>
                    <strong>中等起手牌:</strong> TT, 99, AJ, AT, KQ, KJ<br>
                    <strong>投机起手牌:</strong> 77, 66, A9s, KTs, QJs, JTs<br>
                    <strong>边缘起手牌:</strong> 55, 44, A8o, K9o, QTo<br>
                </div>
            </div>
            
            <div class="result-section">
                <h3 class="section-title">🤖 AI分析结果</h3>
                
                <div id="loadingMessage" style="text-align: center; padding: 40px; display: none;">
                    <div style="border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px;"></div>
                    <p>AI正在分析中...</p>
                </div>
                
                <div id="resultArea" style="display: none;">
                    <div id="handDisplay" class="hand-analysis"></div>
                    
                    <div id="actionsDisplay" class="actions-display"></div>
                    
                    <div id="analysisDisplay" class="hand-analysis"></div>
                    
                    <div id="recommendationDisplay" class="recommendation"></div>
                </div>
                
                <div id="defaultMessage" style="text-align: center; padding: 40px; color: #7f8c8d;">
                    <p>📊 设置游戏参数后点击"获取AI建议"查看专业分析</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
/**
 * 实用德州扑克AI - 纯前端版本 (适用于Vercel部署)
 * Practical Poker AI - Frontend-only version for Vercel deployment
 */

class HandEvaluator {
    constructor() {
        this.ranks = {'2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, 
                     '9': 9, 'T': 10, 'J': 11, 'Q': 12, 'K': 13, 'A': 14};
        this.suits = {'h': 1, 'd': 2, 'c': 3, 's': 4};
        
        // 手牌强度表 (基于Chen公式和实战经验)
        this.handStrengthTable = {
            // 口袋对子
            'AA': 0.95, 'KK': 0.92, 'QQ': 0.88, 'JJ': 0.84, 'TT': 0.78,
            '99': 0.74, '88': 0.70, '77': 0.66, '66': 0.62, '55': 0.58,
            '44': 0.54, '33': 0.50, '22': 0.46,
            
            // 同花牌
            'AKs': 0.86, 'AQs': 0.80, 'AJs': 0.76, 'ATs': 0.72, 'A9s': 0.66,
            'A8s': 0.62, 'A7s': 0.58, 'A6s': 0.56, 'A5s': 0.58, 'A4s': 0.56,
            'A3s': 0.54, 'A2s': 0.54,
            'KQs': 0.78, 'KJs': 0.72, 'KTs': 0.68, 'K9s': 0.62, 'K8s': 0.58,
            'K7s': 0.54, 'K6s': 0.52, 'K5s': 0.50, 'K4s': 0.48, 'K3s': 0.46,
            'K2s': 0.44,
            'QJs': 0.70, 'QTs': 0.66, 'Q9s': 0.60, 'Q8s': 0.56, 'Q7s': 0.52,
            'Q6s': 0.50, 'Q5s': 0.48, 'Q4s': 0.46, 'Q3s': 0.44, 'Q2s': 0.42,
            'JTs': 0.68, 'J9s': 0.62, 'J8s': 0.58, 'J7s': 0.54, 'J6s': 0.50,
            'J5s': 0.48, 'J4s': 0.46, 'J3s': 0.44, 'J2s': 0.42,
            'T9s': 0.64, 'T8s': 0.60, 'T7s': 0.56, 'T6s': 0.52, 'T5s': 0.50,
            'T4s': 0.48, 'T3s': 0.46, 'T2s': 0.44,
            '98s': 0.58, '97s': 0.54, '96s': 0.50, '95s': 0.48, '94s': 0.46,
            '93s': 0.44, '92s': 0.42,
            '87s': 0.56, '86s': 0.52, '85s': 0.50, '84s': 0.48, '83s': 0.46,
            '82s': 0.44,
            '76s': 0.54, '75s': 0.52, '74s': 0.50, '73s': 0.48, '72s': 0.40,
            '65s': 0.52, '64s': 0.50, '63s': 0.48, '62s': 0.46,
            '54s': 0.50, '53s': 0.48, '52s': 0.46,
            '43s': 0.48, '42s': 0.46,
            '32s': 0.44,
            
            // 非同花牌
            'AKo': 0.82, 'AQo': 0.74, 'AJo': 0.68, 'ATo': 0.64, 'A9o': 0.58,
            'A8o': 0.54, 'A7o': 0.50, 'A6o': 0.48, 'A5o': 0.50, 'A4o': 0.48,
            'A3o': 0.46, 'A2o': 0.46,
            'KQo': 0.72, 'KJo': 0.64, 'KTo': 0.60, 'K9o': 0.54, 'K8o': 0.50,
            'K7o': 0.46, 'K6o': 0.44, 'K5o': 0.42, 'K4o': 0.40, 'K3o': 0.38,
            'K2o': 0.36,
            'QJo': 0.62, 'QTo': 0.58, 'Q9o': 0.52, 'Q8o': 0.48, 'Q7o': 0.44,
            'Q6o': 0.42, 'Q5o': 0.40, 'Q4o': 0.38, 'Q3o': 0.36, 'Q2o': 0.34,
            'JTo': 0.60, 'J9o': 0.54, 'J8o': 0.50, 'J7o': 0.46, 'J6o': 0.42,
            'J5o': 0.40, 'J4o': 0.38, 'J3o': 0.36, 'J2o': 0.34,
            'T9o': 0.56, 'T8o': 0.52, 'T7o': 0.48, 'T6o': 0.44, 'T5o': 0.42,
            'T4o': 0.40, 'T3o': 0.38, 'T2o': 0.36,
            '98o': 0.50, '97o': 0.46, '96o': 0.42, '95o': 0.40, '94o': 0.38,
            '93o': 0.36, '92o': 0.34,
            '87o': 0.48, '86o': 0.44, '85o': 0.42, '84o': 0.40, '83o': 0.38,
            '82o': 0.36,
            '76o': 0.46, '75o': 0.44, '74o': 0.42, '73o': 0.40, '72o': 0.32,
            '65o': 0.44, '64o': 0.42, '63o': 0.40, '62o': 0.38,
            '54o': 0.42, '53o': 0.40, '52o': 0.38,
            '43o': 0.40, '42o': 0.38,
            '32o': 0.36
        };
    }
    
    parseCard(cardStr) {
        if (cardStr.length !== 2) {
            throw new Error(`Invalid card format: ${cardStr}`);
        }
        
        const rankChar = cardStr[0].toUpperCase();
        const suitChar = cardStr[1].toLowerCase();
        
        if (!(rankChar in this.ranks) || !(suitChar in this.suits)) {
            throw new Error(`Invalid card: ${cardStr}`);
        }
        
        return {
            rank: this.ranks[rankChar],
            suit: this.suits[suitChar],
            rankChar: rankChar,
            suitChar: suitChar
        };
    }
    
    evaluateHandStrength(holeCards, communityCards = "") {
        try {
            // 解析底牌
            const cards = holeCards.toUpperCase().replace(/[, ]/g, "");
            if (cards.length !== 4) {
                return 0.5; // 默认中等强度
            }
            
            const card1 = this.parseCard(cards.slice(0, 2));
            const card2 = this.parseCard(cards.slice(2, 4));
            
            // 生成手牌键值
            let handKey;
            const isSuited = card1.suit === card2.suit;
            const isPair = card1.rank === card2.rank;
            
            if (isPair) {
                handKey = card1.rankChar + card2.rankChar;
            } else {
                // 按rank排序，大的在前
                if (card1.rank > card2.rank) {
                    handKey = card1.rankChar + card2.rankChar + (isSuited ? 's' : 'o');
                } else {
                    handKey = card2.rankChar + card1.rankChar + (isSuited ? 's' : 'o');
                }
            }
            
            // 查找手牌强度
            let strength = this.handStrengthTable[handKey] || 0.5;
            
            // 根据公共牌调整强度 (简化版)
            if (communityCards) {
                // 这里可以添加更复杂的后翻牌评估逻辑
                // 目前仅做简单调整
                strength *= 1.1; // 略微提升，因为看到了更多信息
            }
            
            return Math.min(0.95, Math.max(0.05, strength));
            
        } catch (error) {
            console.error('Hand evaluation error:', error);
            return 0.5;
        }
    }
}

class PokerAI {
    constructor() {
        this.handEvaluator = new HandEvaluator();
        
        // 位置映射
        this.positions6max = ['UTG', 'MP', 'CO', 'BTN', 'SB', 'BB'];
        this.positions5max = ['UTG', 'CO', 'BTN', 'SB', 'BB'];
        
        // 动作映射
        this.actions = ['FOLD', 'CHECK/CALL', 'BET/RAISE_SMALL', 'BET/RAISE_MID', 'BET/RAISE_BIG', 'ALL-IN'];
        
        // 位置强度表
        this.positionStrength = {
            'UTG': 0.2,
            'MP': 0.4,
            'CO': 0.7,
            'BTN': 1.0,
            'SB': 0.3,
            'BB': 0.5
        };
    }
    
    calculateActionProbabilities(handStrength, positionStrength, potOdds, stackPotRatio) {
        // 基础概率矩阵 - 根据手牌强度调整
        let probs;
        
        if (handStrength > 0.85) { // 超强牌 (AA, KK, AKs等)
            probs = [0.02, 0.08, 0.15, 0.35, 0.30, 0.10];
        } else if (handStrength > 0.75) { // 强牌 (QQ, JJ, AQ等)
            probs = [0.05, 0.15, 0.25, 0.30, 0.20, 0.05];
        } else if (handStrength > 0.65) { // 中强牌 (TT, AJ, KQ等)
            probs = [0.10, 0.30, 0.25, 0.20, 0.12, 0.03];
        } else if (handStrength > 0.55) { // 中等牌 (99, AT, KJ等)
            probs = [0.15, 0.40, 0.20, 0.15, 0.08, 0.02];
        } else if (handStrength > 0.45) { // 中弱牌 (88, A9, QJ等)
            probs = [0.25, 0.45, 0.15, 0.10, 0.04, 0.01];
        } else if (handStrength > 0.35) { // 弱牌 (77, KT, Q9等)
            probs = [0.40, 0.40, 0.10, 0.07, 0.02, 0.01];
        } else { // 垃圾牌 (大部分不连续、不同花的牌)
            probs = [0.70, 0.25, 0.03, 0.015, 0.004, 0.001];
        }
        
        // 位置调整
        if (positionStrength > 0.8) { // 后位 (BTN)
            probs[2] *= 1.3; // 增加小注概率
            probs[3] *= 1.2; // 增加中注概率
            probs[0] *= 0.8; // 减少弃牌概率
        } else if (positionStrength > 0.6) { // CO位
            probs[2] *= 1.2;
            probs[3] *= 1.1;
            probs[0] *= 0.9;
        } else if (positionStrength < 0.3) { // 前位 (UTG, SB)
            probs[0] *= 1.4; // 增加弃牌概率
            probs[2] *= 0.7; // 减少下注概率
            probs[3] *= 0.6;
            probs[4] *= 0.5;
        }
        
        // 底池赔率调整
        if (potOdds > 0.3) { // 需要跟注很多
            if (handStrength < 0.6) {
                probs[0] *= 1.5; // 弱牌更容易弃牌
                probs[1] *= 0.6; // 减少跟注
            }
        } else if (potOdds < 0.1) { // 很便宜或免费
            probs[1] *= 1.3; // 增加跟注/过牌
            probs[0] *= 0.7; // 减少弃牌
        }
        
        // 筹码深度调整
        if (stackPotRatio < 3) { // 短筹码
            probs[5] *= 2.0; // 增加全下概率
            probs[3] *= 0.7; // 减少中等下注
            probs[4] *= 0.8;
        } else if (stackPotRatio > 15) { // 深筹码
            probs[5] *= 0.3; // 减少全下
            probs[2] *= 1.2; // 增加小注概率
        }
        
        // 确保概率和为1
        const total = probs.reduce((sum, p) => sum + p, 0);
        probs = probs.map(p => p / total);
        
        return probs;
    }
    
    getActionRecommendation(gameState) {
        try {
            // 解析游戏状态
            const numPlayers = gameState.numPlayers || 6;
            const holeCards = gameState.holeCards || '';
            const communityCards = gameState.communityCards || '';
            const position = gameState.position || 'BTN';
            const potSize = gameState.potSize || 100;
            const betToCall = gameState.betToCall || 0;
            const stackSize = gameState.stackSize || 1000;
            
            // 评估手牌强度
            const handStrength = this.handEvaluator.evaluateHandStrength(holeCards, communityCards);
            
            // 计算基本特征
            const potOdds = betToCall / (potSize + betToCall) || 0;
            const stackPotRatio = stackSize / potSize || 10;
            const positionStrength = this.positionStrength[position] || 0.5;
            
            // 计算动作概率
            const actionProbs = this.calculateActionProbabilities(
                handStrength, positionStrength, potOdds, stackPotRatio
            );
            
            // 选择最佳动作
            const bestActionIdx = actionProbs.indexOf(Math.max(...actionProbs));
            
            return {
                holeCards: holeCards,
                handStrength: handStrength,
                recommendedAction: {
                    action: bestActionIdx,
                    actionName: this.actions[bestActionIdx],
                    confidence: actionProbs[bestActionIdx]
                },
                actionProbabilities: actionProbs,
                actionNames: this.actions,
                analysis: {
                    handStrength: handStrength.toFixed(3),
                    positionStrength: positionStrength.toFixed(3),
                    potOdds: potOdds.toFixed(3),
                    recommendation: this.getRecommendationText(handStrength, positionStrength, potOdds)
                }
            };
            
        } catch (error) {
            console.error('Action recommendation error:', error);
            return { error: error.message };
        }
    }
    
    getRecommendationText(handStrength, positionStrength, potOdds) {
        if (handStrength > 0.85) {
            return "超强牌，建议激进下注或加注，价值最大化";
        } else if (handStrength > 0.75) {
            return "强牌，适合价值下注，可以应对加注";
        } else if (handStrength > 0.65) {
            return "中强牌，根据位置和对手行动决定策略";
        } else if (handStrength > 0.55) {
            if (positionStrength > 0.7) {
                return "中等牌在后位，可以考虑偷盲或小额下注";
            } else {
                return "中等牌在前位，建议谨慎行动";
            }
        } else if (handStrength > 0.45) {
            if (potOdds < 0.2 && positionStrength > 0.6) {
                return "投机牌，在后位且赔率合适时可以跟注";
            } else {
                return "弱牌，建议弃牌，除非有很好的底池赔率";
            }
        } else {
            return "垃圾牌，建议弃牌，保存筹码等待更好机会";
        }
    }
}

// 全局AI实例
const pokerAI = new PokerAI();

// 更新位置选项
function updatePositions() {
    const numPlayers = document.getElementById('numPlayers').value;
    const positionSelect = document.getElementById('position');
    
    const positions6 = [
        {value: 'UTG', text: 'UTG (枪口位)'},
        {value: 'MP', text: 'MP (中位)'},
        {value: 'CO', text: 'CO (关煞位)'},
        {value: 'BTN', text: 'BTN (按钮位)'},
        {value: 'SB', text: 'SB (小盲位)'},
        {value: 'BB', text: 'BB (大盲位)'}
    ];
    
    const positions5 = [
        {value: 'UTG', text: 'UTG (枪口位)'},
        {value: 'CO', text: 'CO (关煞位)'},
        {value: 'BTN', text: 'BTN (按钮位)'},
        {value: 'SB', text: 'SB (小盲位)'},
        {value: 'BB', text: 'BB (大盲位)'}
    ];
    
    const positions = numPlayers === '6' ? positions6 : positions5;
    const currentValue = positionSelect.value;
    
    positionSelect.innerHTML = '';
    positions.forEach(pos => {
        const option = document.createElement('option');
        option.value = pos.value;
        option.textContent = pos.text;
        positionSelect.appendChild(option);
    });
    
    // 尝试保持当前选择
    if (positions.find(p => p.value === currentValue)) {
        positionSelect.value = currentValue;
    } else {
        positionSelect.value = 'BTN';
    }
}

// 获取AI建议
function getAIRecommendation() {
    const card1 = document.getElementById('card1').value.trim();
    const card2 = document.getElementById('card2').value.trim();
    
    if (!card1 || !card2) {
        showError('请输入你的底牌');
        return;
    }
    
    const gameState = {
        numPlayers: parseInt(document.getElementById('numPlayers').value),
        position: document.getElementById('position').value,
        holeCards: card1 + card2,
        communityCards: getCommunityCards(),
        potSize: parseInt(document.getElementById('potSize').value),
        betToCall: parseInt(document.getElementById('betToCall').value),
        stackSize: parseInt(document.getElementById('stackSize').value)
    };
    
    showLoading();
    
    // 模拟异步处理
    setTimeout(() => {
        try {
            const result = pokerAI.getActionRecommendation(gameState);
            
            if (result.error) {
                showError(result.error);
            } else {
                showResult(result);
            }
        } catch (error) {
            showError('AI分析出错: ' + error.message);
        }
    }, 500); // 500ms延迟模拟处理时间
}

// 获取公共牌
function getCommunityCards() {
    const cards = [
        document.getElementById('flop1').value,
        document.getElementById('flop2').value,
        document.getElementById('flop3').value,
        document.getElementById('turn').value,
        document.getElementById('river').value
    ].filter(card => card.trim());
    
    return cards.join('');
}

// 随机手牌
function randomizeHand() {
    const ranks = ['A', 'K', 'Q', 'J', 'T', '9', '8', '7', '6', '5', '4', '3', '2'];
    const suits = ['s', 'h', 'd', 'c'];
    
    const rank1 = ranks[Math.floor(Math.random() * ranks.length)];
    const suit1 = suits[Math.floor(Math.random() * suits.length)];
    
    let rank2, suit2;
    do {
        rank2 = ranks[Math.floor(Math.random() * ranks.length)];
        suit2 = suits[Math.floor(Math.random() * suits.length)];
    } while (rank1 === rank2 && suit1 === suit2);
    
    document.getElementById('card1').value = rank1 + suit1;
    document.getElementById('card2').value = rank2 + suit2;
}

// 加载示例
function loadExample() {
    const examples = [
        {
            card1: 'As', card2: 'Kh', 
            pot: 30, toCall: 15, stack: 1000,
            desc: '强牌AK，前位有人下注'
        },
        {
            card1: 'Qh', card2: 'Qs', 
            pot: 50, toCall: 0, stack: 800,
            desc: '口袋QQ，无人下注'
        },
        {
            card1: 'Tc', card2: '9s', 
            pot: 100, toCall: 50, stack: 600,
            desc: '投机牌T9，大注压力'
        },
        {
            card1: '7h', card2: '7d', 
            pot: 40, toCall: 20, stack: 1200,
            desc: '小对子77，中等下注'
        },
        {
            card1: 'Ah', card2: '5s',
            pot: 60, toCall: 30, stack: 900,
            desc: 'A5o，中等位置，需要决策'
        },
        {
            card1: 'Kd', card2: 'Qc',
            pot: 25, toCall: 0, stack: 1500,
            desc: 'KQo，后位无人下注'
        }
    ];
    
    const example = examples[Math.floor(Math.random() * examples.length)];
    
    document.getElementById('card1').value = example.card1;
    document.getElementById('card2').value = example.card2;
    document.getElementById('potSize').value = example.pot;
    document.getElementById('betToCall').value = example.toCall;
    document.getElementById('stackSize').value = example.stack;
    
    showMessage(`📋 已加载示例: ${example.desc}`, 'info');
}

// 显示消息
function showMessage(message, type = 'info') {
    const colors = {
        'info': '#e7f3ff',
        'success': '#d4edda',
        'warning': '#fff3cd',
        'error': '#f8d7da'
    };
    
    const messageDiv = document.createElement('div');
    messageDiv.style.cssText = `
        background: ${colors[type]};
        padding: 10px 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid #0066cc;
        animation: fadeInOut 3s ease-in-out;
    `;
    messageDiv.textContent = message;
    
    const container = document.querySelector('.input-section');
    container.insertBefore(messageDiv, container.firstChild);
    
    setTimeout(() => messageDiv.remove(), 3000);
}

// 显示加载状态
function showLoading() {
    document.getElementById('defaultMessage').style.display = 'none';
    document.getElementById('resultArea').style.display = 'none';
    document.getElementById('loadingMessage').style.display = 'block';
}

// 显示结果
function showResult(result) {
    document.getElementById('loadingMessage').style.display = 'none';
    document.getElementById('defaultMessage').style.display = 'none';
    document.getElementById('resultArea').style.display = 'block';
    
    // 显示手牌
    document.getElementById('handDisplay').innerHTML = `
        <h4>🎴 你的手牌</h4>
        <div style="margin: 10px 0;">
            <span class="card-display">${result.holeCards.slice(0,2)}</span>
            <span class="card-display">${result.holeCards.slice(2,4)}</span>
        </div>
        <p>手牌强度: <strong>${(result.handStrength * 100).toFixed(1)}%</strong></p>
    `;
    
    // 显示动作概率
    let actionsHTML = '';
    result.actionProbabilities.forEach((prob, index) => {
        const isRecommended = index === result.recommendedAction.action;
        const isLikely = prob > 0.15;
        const className = isRecommended ? 'recommended' : (isLikely ? 'likely' : '');
        
        actionsHTML += `
            <div class="action-card ${className}">
                <div class="action-name">${result.actionNames[index]}</div>
                <div class="action-prob">${(prob * 100).toFixed(1)}%</div>
            </div>
        `;
    });
    document.getElementById('actionsDisplay').innerHTML = actionsHTML;
    
    // 显示分析
    document.getElementById('analysisDisplay').innerHTML = `
        <h4>📊 详细分析</h4>
        <div class="analysis-row">
            <span>手牌强度:</span>
            <span>${result.analysis.handStrength}</span>
        </div>
        <div class="analysis-row">
            <span>位置强度:</span>
            <span>${result.analysis.positionStrength}</span>
        </div>
        <div class="analysis-row">
            <span>底池赔率:</span>
            <span>${result.analysis.potOdds}</span>
        </div>
    `;
    
    // 显示推荐
    document.getElementById('recommendationDisplay').innerHTML = `
        <h4>💡 AI推荐</h4>
        <p><strong>建议动作:</strong> ${result.recommendedAction.actionName}</p>
        <p><strong>置信度:</strong> ${(result.recommendedAction.confidence * 100).toFixed(1)}%</p>
        <p><strong>分析:</strong> ${result.analysis.recommendation}</p>
    `;
}

// 显示错误
function showError(message) {
    document.getElementById('loadingMessage').style.display = 'none';
    document.getElementById('resultArea').style.display = 'none';
    document.getElementById('defaultMessage').innerHTML = `
        <div class="error">❌ ${message}</div>
    `;
    document.getElementById('defaultMessage').style.display = 'block';
}

// 初始化
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('numPlayers').addEventListener('change', updatePositions);
    updatePositions();
});
    </script>
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</body>
</html>